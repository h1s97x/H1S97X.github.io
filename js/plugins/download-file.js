function extToMimes(a){let e;switch(a){case"jpg":e="image/jpeg";break;case"png":e="image/png";break;case"jpeg":e="image/jpeg";break;case"gif":e="image/gif";break;case"bmp":e="image/bmp";break;case"txt":e="text/plain";break;case"xls":e="application/vnd.ms-excel";break;case"doc":e="application/msword";break;case"pdf":e="application/pdf";break;case"xlsx":e="application/vnd.ms-excel";break;case"csv":e="text/csv";break;case"mp4":e="video/mp4";break;case"avi":e="video/x-msvideo";break;case"WindowsMediaVideo":e="video/x-ms-wmv";break;case"mov":e="video/quicktime";break;case"flash":e="video/x-flv";break;case"mkv":e="video/x-matroska";break;case"mp3":e="audio/mpeg";break;case"wav":e="audio/wav";break;case"flac":e="audio/flac";break;case"aac":e="audio/aac";break;case"wma":e="audio/x-ms-wma";break;default:e="text/plain";break}return e}function formatFileSize(a){const e=["B","KB","MB","GB","TB","PB","EB","ZB","YB"];let t=a,i=0;for(;t>=1024&&i<e.length-1;)t/=1024,i++;return t=Math.round(t*100)/100,`${t}${e[i]}`}var file_contents={};function cacheDatas(a,e){let t=e.file,i=a.split("/").at(-1),b=i.split(".")[1],f=extToMimes(b);const l=t?t.data.length:0;let n=new ArrayBuffer(l),o=new Uint8Array(n);for(let d=0;d<l;++d)o[d]=t.data[d];let r=new Blob([n],{type:f}),c=formatFileSize(r.size),s={};s.name=i,s.size=c,s.blob=r,file_contents[a]=s}function renderFileDom(a,e){let t=a.querySelector(".file-size"),i=file_contents[e].size;t&&i&&(t.innerHTML=i)}function downloadFile(a){let e=file_contents[a],t=document.createElement("a");t.download=e.name,t.href=URL.createObjectURL(e.blob),document.body.appendChild(t),t.click(),document.body.removeChild(t)}function downloadFileEvent(a){for(let e=0;e<a.length;++e){let t=a[e];const i=ctx.tag_plugins.chat.api+"?type=file&url=";new IntersectionObserver((f,l)=>{utils.requestAnimationFrame(()=>{f.filter(n=>n.isIntersecting).sort((n,o)=>n.intersectionRect.y!==o.intersectionRect.y?n.intersectionRect.y-o.intersectionRect.y:n.intersectionRect.x-o.intersectionRect.x).forEach((n,o)=>{l.unobserve(n.target),setTimeout(()=>{let r=n.target.getAttribute("url");fetch(i+r).then(function(c){if(c.ok)return c.json();throw new Error("Network response was not ok.")}).then(function(c){cacheDatas(r,c),renderFileDom(t,r)}).catch(function(c){console.log(c)}),t.addEventListener("click",()=>{downloadFile(r)})},Math.max(100,16)*(o+1))})})}).observe(t)}}
