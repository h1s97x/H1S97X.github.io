utils.jq(()=>{$(function(){const i=document.querySelector(".ds-twikoo");utils.onLoading(i);const n=i.dataset.api,l=parseInt(i.getAttribute("limit"))||10,r=i.getAttribute("hide")!=="reply";n&&fetch(n,{method:"POST",body:JSON.stringify({event:"GET_RECENT_COMMENTS",envId:n,pageSize:l,includeReply:r}),headers:{"Content-Type":"application/json"}}).then(s=>s.json()).then(({data:s})=>{utils.onLoadSuccess(i),s.forEach((a,d)=>{let t=a.commentText;if(!(!t||t.trim()==="")){t=t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;"),t=t.length>50?t.substring(0,50)+"...":t;var e='<div class="timenode" index="'+d+'">';e+='<div class="header">',e+='<div class="user-info">',e+="<span>"+a.nick+"</span>",e+="</div>",e+="<span>"+new Date(a.created).toLocaleString("zh-CN",{month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",hour12:!1})+"</span>",e+="</div>",e+='<a class="body" href="'+a.url+"#"+a.id+'">',e+=t,e+="</a>",e+="</div>",$(i).append(e)}})}).catch(()=>utils.onLoadFailure(i))})});
