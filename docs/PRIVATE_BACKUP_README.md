# ç§æœ‰å¤‡ä»½ç³»ç»Ÿ

è¿™æ˜¯ä¸€ä¸ªç®€åŒ–çš„ç§æœ‰å¤‡ä»½è§£å†³æ–¹æ¡ˆï¼Œé€šè¿‡åˆ›å»ºç§æœ‰GitHubä»“åº“æ¥å¤‡ä»½æ‰€æœ‰æœ¬åœ°å†…å®¹ï¼Œå¹¶è®¾ç½®æ¯æ—¥è‡ªåŠ¨åŒæ­¥ã€‚

## åŠŸèƒ½ç‰¹æ€§

- ğŸ”’ **ç§æœ‰ä»“åº“å¤‡ä»½**: åˆ›å»ºä¸å½“å‰ä»“åº“åŒåçš„ç§æœ‰å¤‡ä»½ä»“åº“
- ğŸ¤– **è‡ªåŠ¨åŒæ­¥**: æ¯æ—¥è‡ªåŠ¨åŒæ­¥ï¼Œæ”¯æŒæ‰‹åŠ¨è§¦å‘
- ğŸ“¦ **å®Œæ•´å¤‡ä»½**: åŒ…å«Gitå†å²ã€æ‰€æœ‰åˆ†æ”¯å’Œæ ‡ç­¾
- ğŸ” **å®‰å…¨è®¤è¯**: ä½¿ç”¨GitHubè®¿é—®ä»¤ç‰Œè¿›è¡Œå®‰å…¨è®¤è¯
- ğŸ“Š **çŠ¶æ€ç›‘æ§**: æä¾›è¯¦ç»†çš„å¤‡ä»½çŠ¶æ€å’ŒæŠ¥å‘Š
- ğŸ› ï¸ **æ˜“äºç®¡ç†**: ç®€å•çš„å‘½ä»¤è¡Œå·¥å…·è¿›è¡Œé…ç½®å’Œç®¡ç†

## å¿«é€Ÿå¼€å§‹

### 1. å®‰è£…ä¾èµ–

ç¡®ä¿å·²å®‰è£… [GitHub CLI](https://cli.github.com/):

```bash
# Windows (ä½¿ç”¨ winget)
winget install GitHub.cli

# macOS (ä½¿ç”¨ Homebrew)
brew install gh

# æˆ–è®¿é—® https://cli.github.com/ ä¸‹è½½å®‰è£…
```

### 2. è®¤è¯GitHub CLI

```bash
gh auth login
```

### 3. è®¾ç½®ç§æœ‰å¤‡ä»½ä»“åº“

```bash
# æ‰§è¡Œè‡ªåŠ¨è®¾ç½®
npm run backup:setup

# æˆ–ä½¿ç”¨PowerShell (Windows)
.\tools\setup-private-backup.ps1
```

### 4. é…ç½®è®¿é—®ä»¤ç‰Œ

æŒ‰ç…§ç”Ÿæˆçš„ `.github/BACKUP_TOKEN_SETUP.md` æ–‡ä»¶ä¸­çš„è¯´æ˜é…ç½®GitHubè®¿é—®ä»¤ç‰Œã€‚

### 5. éªŒè¯é…ç½®

```bash
# éªŒè¯é…ç½®æ˜¯å¦æ­£ç¡®
npm run backup:validate

# æŸ¥çœ‹å½“å‰çŠ¶æ€
npm run backup:status
```

## å‘½ä»¤å‚è€ƒ

| å‘½ä»¤ | æè¿° |
|------|------|
| `npm run backup:setup` | è®¾ç½®ç§æœ‰å¤‡ä»½ä»“åº“ |
| `npm run backup:status` | æŸ¥çœ‹å½“å‰é…ç½®çŠ¶æ€ |
| `npm run backup:validate` | éªŒè¯é…ç½®å’Œæƒé™ |
| `npm run backup:test` | æµ‹è¯•å¤‡ä»½åŠŸèƒ½ |

### PowerShell å‘½ä»¤ (Windows)

```powershell
# è®¾ç½®ç§æœ‰å¤‡ä»½ä»“åº“
.\tools\setup-private-backup.ps1

# æŸ¥çœ‹çŠ¶æ€
.\tools\setup-private-backup.ps1 -Status

# éªŒè¯é…ç½®
node tools/validate-backup-config.js
```

## é…ç½®æ–‡ä»¶

### ä¸»è¦é…ç½®æ–‡ä»¶

- `.github/private-backup-config.json` - ç§æœ‰å¤‡ä»½é…ç½®
- `.github/BACKUP_TOKEN_SETUP.md` - è®¿é—®ä»¤ç‰Œè®¾ç½®è¯´æ˜
- `.github/workflows/daily-backup.yml` - è‡ªåŠ¨å¤‡ä»½å·¥ä½œæµç¨‹

### ç¯å¢ƒå˜é‡å’ŒSecrets

éœ€è¦åœ¨GitHubä»“åº“è®¾ç½®ä¸­é…ç½®ä»¥ä¸‹Secrets:

- `BACKUP_REPO_TOKEN` - GitHubä¸ªäººè®¿é—®ä»¤ç‰Œ
- `BACKUP_REPO_NAME` - ç§æœ‰å¤‡ä»½ä»“åº“åç§° (æ ¼å¼: username/repo-name)

## å·¥ä½œæµç¨‹

### è‡ªåŠ¨å¤‡ä»½æµç¨‹

1. **æ¯æ—¥è§¦å‘**: æ¯å¤©å‡Œæ™¨2ç‚¹ (UTC) è‡ªåŠ¨æ‰§è¡Œ
2. **åˆ›å»ºå¤‡ä»½åŒ…**: ç”ŸæˆåŒ…å«æ‰€æœ‰åˆ†æ”¯å’Œæ ‡ç­¾çš„Git bundle
3. **ä¸Šä¼ åˆ°ç§æœ‰ä»“åº“**: å°†å¤‡ä»½æ–‡ä»¶æ¨é€åˆ°ç§æœ‰ä»“åº“
4. **ç”ŸæˆæŠ¥å‘Š**: åˆ›å»ºè¯¦ç»†çš„å¤‡ä»½æŠ¥å‘Šå’Œç»Ÿè®¡ä¿¡æ¯
5. **æ¸…ç†æ—§å¤‡ä»½**: è‡ªåŠ¨åˆ é™¤30å¤©å‰çš„æ—§å¤‡ä»½æ–‡ä»¶

### æ‰‹åŠ¨å¤‡ä»½

```bash
# æ‰‹åŠ¨è§¦å‘GitHub Actionså·¥ä½œæµç¨‹
gh workflow run "Daily Repository Backup"

# æˆ–ç›´æ¥æ¨é€åˆ°å¤‡ä»½ä»“åº“
git push backup main
```

## æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

#### 1. GitHub CLI æœªè®¤è¯

```bash
# é‡æ–°è®¤è¯
gh auth login

# æ£€æŸ¥è®¤è¯çŠ¶æ€
gh auth status
```

#### 2. è®¿é—®ä»¤ç‰Œæƒé™ä¸è¶³

ç¡®ä¿è®¿é—®ä»¤ç‰Œå…·æœ‰ä»¥ä¸‹æƒé™:
- `repo` (å®Œæ•´ä»“åº“è®¿é—®æƒé™)
- `workflow` (å·¥ä½œæµç¨‹æƒé™)

#### 3. ç§æœ‰ä»“åº“ä¸å­˜åœ¨

```bash
# é‡æ–°è¿è¡Œè®¾ç½®è„šæœ¬
npm run backup:setup
```

#### 4. æ¨é€æƒé™è¢«æ‹’ç»

æ£€æŸ¥:
- GitHubè®¿é—®ä»¤ç‰Œæ˜¯å¦æœ‰æ•ˆ
- ä»“åº“æƒé™è®¾ç½®æ˜¯å¦æ­£ç¡®
- ç½‘ç»œè¿æ¥æ˜¯å¦æ­£å¸¸

### è¯Šæ–­å‘½ä»¤

```bash
# å®Œæ•´é…ç½®éªŒè¯
npm run backup:validate

# æ£€æŸ¥Gitè¿œç¨‹é…ç½®
git remote -v

# æµ‹è¯•ä»“åº“è¿æ¥
git ls-remote backup

# æ£€æŸ¥GitHub CLIçŠ¶æ€
gh auth status
```

## å®‰å…¨æ³¨æ„äº‹é¡¹

- ğŸ”’ **è®¿é—®ä»¤ç‰Œå®‰å…¨**: æ°¸è¿œä¸è¦å°†è®¿é—®ä»¤ç‰Œæäº¤åˆ°ä»£ç ä»“åº“
- ğŸ”„ **å®šæœŸè½®æ¢**: å»ºè®®æ¯90å¤©è½®æ¢ä¸€æ¬¡è®¿é—®ä»¤ç‰Œ
- ğŸ‘¥ **æœ€å°æƒé™**: åªæˆäºˆå¿…è¦çš„æœ€å°æƒé™
- ğŸ“ **ä»¤ç‰Œç®¡ç†**: ä¸ºä»¤ç‰Œæ·»åŠ æè¿°æ€§åç§°ä»¥ä¾¿ç®¡ç†
- ğŸ” **ç§æœ‰ä»“åº“**: ç¡®ä¿å¤‡ä»½ä»“åº“è®¾ç½®ä¸ºç§æœ‰

## é«˜çº§é…ç½®

### è‡ªå®šä¹‰å¤‡ä»½è°ƒåº¦

ç¼–è¾‘ `.github/workflows/daily-backup.yml` ä¸­çš„ cron è¡¨è¾¾å¼:

```yaml
schedule:
  # æ¯å¤©å‡Œæ™¨2ç‚¹ (UTC)
  - cron: '0 2 * * *'
  
  # æ¯12å°æ—¶ä¸€æ¬¡
  # - cron: '0 */12 * * *'
  
  # æ¯å‘¨ä¸€æ¬¡ (å‘¨æ—¥å‡Œæ™¨)
  # - cron: '0 2 * * 0'
```

### è‡ªå®šä¹‰å¤‡ä»½ä¿ç•™æœŸ

ä¿®æ”¹å·¥ä½œæµç¨‹ä¸­çš„æ¸…ç†æ­¥éª¤:

```yaml
# åˆ é™¤30å¤©å‰çš„å¤‡ä»½æ–‡ä»¶
find backups/ -name "*.bundle" -type f -mtime +30 -delete

# æ”¹ä¸ºä¿ç•™60å¤©
# find backups/ -name "*.bundle" -type f -mtime +60 -delete
```

### æœ¬åœ°å¤‡ä»½è„šæœ¬é›†æˆ

æ›´æ–°ç°æœ‰çš„ `tools/backup-repository.ps1` è„šæœ¬ä»¥æ”¯æŒç§æœ‰ä»“åº“æ¨é€:

```powershell
# åœ¨è„šæœ¬æœ«å°¾æ·»åŠ ç§æœ‰ä»“åº“æ¨é€
if (Test-Path ".github/private-backup-config.json") {
    Write-Host "ğŸ”„ æ¨é€åˆ°ç§æœ‰å¤‡ä»½ä»“åº“..." -ForegroundColor Yellow
    git push backup main
    Write-Host "âœ… ç§æœ‰å¤‡ä»½æ¨é€å®Œæˆ" -ForegroundColor Green
}
```

## æ”¯æŒå’Œåé¦ˆ

å¦‚æœé‡åˆ°é—®é¢˜æˆ–æœ‰æ”¹è¿›å»ºè®®ï¼Œè¯·:

1. è¿è¡Œ `npm run backup:validate` è¿›è¡Œè¯Šæ–­
2. æŸ¥çœ‹ GitHub Actions å·¥ä½œæµç¨‹æ—¥å¿—
3. æ£€æŸ¥ `.github/BACKUP_TOKEN_SETUP.md` é…ç½®è¯´æ˜
4. å‚è€ƒæœ¬æ–‡æ¡£çš„æ•…éšœæ’é™¤éƒ¨åˆ†

## æ›´æ–°æ—¥å¿—

- **v1.0.0** - åˆå§‹ç‰ˆæœ¬ï¼Œæ”¯æŒç§æœ‰ä»“åº“åˆ›å»ºå’Œè‡ªåŠ¨å¤‡ä»½
- æ”¯æŒ Windows PowerShell å’Œè·¨å¹³å° Node.js è„šæœ¬
- é›†æˆ GitHub CLI è¿›è¡Œä»“åº“ç®¡ç†
- æä¾›å®Œæ•´çš„é…ç½®éªŒè¯å’ŒçŠ¶æ€ç›‘æ§