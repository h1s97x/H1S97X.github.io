# 搜索配置

Stellar 主题支持本地搜索和 Algolia 搜索两种搜索方式。

## 配置概览

| 字段 | 类型 | 说明 |
|------|------|------|
| service | string | 搜索服务类型 |
| local_search | object | 本地搜索配置 |
| algolia_search | object | Algolia 搜索配置 |

## service - 搜索服务

选择使用的搜索服务。

**可选值**：
- `local_search`：本地搜索（推荐）
- `algolia_search`：Algolia 搜索

**配置示例**：

```yaml
search:
  service: local_search
```

## 本地搜索配置

### 基础配置

```yaml
search:
  service: local_search
  local_search:
    field: all
    path: /search.json
    content: true
    skip_search:
      - /music/
      - /about/
```

### 配置项说明

| 字段 | 类型 | 默认值 | 说明 |
|------|------|--------|------|
| field | string | all | 搜索范围 |
| path | string | /search.json | 搜索索引文件路径 |
| content | boolean | true | 是否搜索正文内容 |
| skip_search | array | - | 排除的路径 |

### field - 搜索范围

控制搜索的内容范围。

**可选值**：
- `all`：搜索所有内容（文章、页面）
- `post`：仅搜索文章
- `page`：仅搜索页面

**配置示例**：

```yaml
local_search:
  field: all  # 搜索所有内容
```

### path - 索引文件路径

搜索索引文件的存放位置。

**配置示例**：

```yaml
local_search:
  path: /search.json
```

**注意事项**：
- 路径必须以 `/` 开头
- 文件会在构建时自动生成
- 不要修改此路径，除非有特殊需求

### content - 搜索正文

是否在搜索时包含文章正文内容。

**配置示例**：

```yaml
local_search:
  content: true  # 搜索正文
```

**说明**：
- `true`：搜索标题、标签、分类、正文
- `false`：仅搜索标题、标签、分类

**性能考虑**：
- 启用正文搜索会增大索引文件
- 对于大型站点，建议设置为 `false`

### skip_search - 排除路径

指定不被搜索索引的路径。

**配置示例**：

```yaml
local_search:
  skip_search:
    - /music/
    - /about/
    - /contact/
```

**使用场景**：
- 排除音乐、视频等媒体页面
- 排除关于、联系等静态页面
- 排除不需要被搜索的内容

### 在文章中禁用索引

在文章 front-matter 中设置：

```yaml
---
indexing: false
---
```

## Algolia 搜索配置

Algolia 是一个强大的第三方搜索服务，适合大型站点。

### 申请 Algolia

1. 访问 [Algolia Docsearch](https://docsearch.algolia.com/apply/)
2. 填写申请表单
3. 等待审核通过
4. 获取 API 密钥

### 配置示例

```yaml
search:
  service: algolia_search
  algolia_search:
    appId: YOUR_APP_ID
    apiKey: YOUR_API_KEY
    indexName: YOUR_INDEX_NAME
    js: https://gcore.jsdelivr.net/algoliasearch/3/algoliasearch.min.js
```

### 配置项说明

| 字段 | 类型 | 说明 |
|------|------|------|
| appId | string | Algolia 应用 ID |
| apiKey | string | Algolia API 密钥 |
| indexName | string | 索引名称 |
| js | string | Algolia JS 库地址 |

### 优势

- 搜索速度快
- 支持高级搜索功能
- 提供搜索分析
- 支持多语言

### 劣势

- 需要申请账号
- 免费版有限制
- 配置相对复杂

## 搜索页面配置

### 创建搜索页面

创建 `source/search/index.md`：

```yaml
---
layout: page
title: 搜索
---
```

### 添加搜索入口

在侧边栏菜单中添加搜索入口：

```yaml
menubar:
  items:
    - id: search
      icon: solar:magnifer-bold-duotone
      title: 搜索
      url: /search/
```

## 完整配置示例

### 小型博客配置

```yaml
search:
  service: local_search
  local_search:
    field: all
    path: /search.json
    content: true
    skip_search: []
```

### 中型博客配置

```yaml
search:
  service: local_search
  local_search:
    field: all
    path: /search.json
    content: true
    skip_search:
      - /music/
      - /about/
      - /contact/
```

### 大型站点配置

```yaml
search:
  service: local_search
  local_search:
    field: post  # 仅搜索文章
    path: /search.json
    content: false  # 不搜索正文，减小索引
    skip_search:
      - /music/
      - /about/
      - /contact/
      - /archives/
```

### 使用 Algolia

```yaml
search:
  service: algolia_search
  algolia_search:
    appId: YOUR_APP_ID
    apiKey: YOUR_API_KEY
    indexName: blog
    js: https://gcore.jsdelivr.net/algoliasearch/3/algoliasearch.min.js
```

## 搜索优化

### 1. 优化索引大小

**减小索引文件**：
```yaml
local_search:
  field: post  # 仅索引文章
  content: false  # 不索引正文
```

**排除不必要的页面**：
```yaml
local_search:
  skip_search:
    - /music/
    - /gallery/
    - /links/
```

### 2. 提升搜索质量

**使用描述性标题**：
```yaml
---
title: 详细的文章标题
---
```

**添加关键词标签**：
```yaml
---
tags: [JavaScript, React, 教程]
---
```

**设置文章描述**：
```yaml
---
description: 这是一篇关于 React Hooks 的详细教程
---
```

### 3. 搜索体验优化

**添加搜索快捷键**：
- 通常使用 `/` 或 `Ctrl+K` 打开搜索
- Stellar 主题已内置支持

**搜索结果高亮**：
- 自动高亮匹配的关键词
- 显示匹配的上下文

## 最佳实践

### 1. 选择搜索服务

| 场景 | 推荐方案 |
|------|----------|
| 个人博客（< 100 篇） | 本地搜索 + 搜索正文 |
| 中型博客（100-500 篇） | 本地搜索 + 不搜索正文 |
| 大型站点（> 500 篇） | Algolia 搜索 |
| 文档站点 | Algolia 搜索 |

### 2. 索引优化

- 定期检查索引文件大小
- 排除不需要搜索的页面
- 对于大型站点，考虑仅索引标题和标签

### 3. 内容优化

- 使用清晰的标题
- 添加相关标签
- 设置准确的描述

## 常见问题

### 搜索功能不工作？

1. 检查 `search.json` 是否生成
2. 确认搜索页面已创建
3. 清理缓存重新构建

### 搜索结果不准确？

1. 检查 `field` 设置是否正确
2. 确认 `content` 是否启用
3. 验证文章是否被 `skip_search` 排除

### 索引文件太大？

1. 设置 `content: false`
2. 设置 `field: post`
3. 添加更多 `skip_search` 路径

### 如何测试搜索？

```bash
# 本地预览
npm run server

# 访问搜索页面
# http://localhost:4000/search/

# 测试搜索功能
```

### Algolia 搜索不工作？

1. 确认 API 密钥正确
2. 检查索引名称
3. 验证网络可访问 Algolia
4. 查看浏览器控制台错误

## 相关配置

- [站点结构配置](./站点结构配置.md) - 配置搜索页面布局
- [侧边栏配置](./侧边栏配置.md) - 添加搜索菜单项

## 参考资源

- [hexo-generator-searchdb](https://github.com/next-theme/hexo-generator-searchdb)
- [Algolia Docsearch](https://docsearch.algolia.com/)
- [Algolia 文档](https://www.algolia.com/doc/)
